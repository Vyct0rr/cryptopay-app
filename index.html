<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CryptoPay</title>
    <style>
        /* CORE STYLES */
        :root {
            --primary: #4F46E5;
            --bg: #F3F4F6;
            --card-bg: #ffffff;
            --text-main: #1F2937;
            --text-sub: #6B7280;
            --border: #E5E7EB;
            --success: #10B981;
            --danger: #EF4444;
        }
        
        /* DARK MODE VARS */
        body.dark-mode {
            --bg: #111827;
            --card-bg: #1F2937;
            --text-main: #F9FAFB;
            --text-sub: #9CA3AF;
            --border: #374151;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text-main); padding-bottom: 90px; transition: background 0.3s; }
        
        /* UTILITIES */
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .p-4 { padding: 16px; }
        .mb-4 { margin-bottom: 16px; }
        .text-center { text-align: center; }
        .font-bold { font-weight: 700; }
        .text-xl { font-size: 1.25rem; }
        .text-sm { font-size: 0.875rem; }
        .text-gray { color: var(--text-sub); }
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        
        /* COMPONENTS */
        .card { background: var(--card-bg); border-radius: 16px; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); margin-bottom: 15px; border: 1px solid var(--border); transition: background 0.3s; }
        
        .btn { border: none; padding: 14px 20px; border-radius: 12px; font-weight: 600; cursor: pointer; width: 100%; font-size: 1rem; margin-top: 10px; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-outline { border: 1px solid var(--border); background: var(--card-bg); color: var(--text-sub); }
        .btn-outline.active { border-color: var(--primary); color: var(--primary); background: rgba(79, 70, 229, 0.1); }
        
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; margin-bottom: 8px; font-size: 0.9rem; color: var(--text-sub); }
        .input-field { width: 100%; padding: 14px; border: 1px solid var(--border); border-radius: 12px; font-size: 1rem; outline: none; background: var(--bg); color: var(--text-main); }
        .select-field { width: 100%; padding: 14px; border: 1px solid var(--border); border-radius: 12px; font-size: 1rem; background: var(--card-bg); color: var(--text-main); }

        /* NAV & HEADER */
        header { background: var(--card-bg); padding: 15px 20px; position: sticky; top: 0; z-index: 10; display: flex; justify-content: space-between; border-bottom: 1px solid var(--border); }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: var(--card-bg); display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid var(--border); z-index: 20; }
        .nav-item { display: flex; flex-direction: column; align-items: center; font-size: 0.75rem; color: var(--text-sub); text-decoration: none; }
        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 1.4rem; margin-bottom: 4px; }

        /* HOME SPECIFIC */
        .balance-card { background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%); color: white; text-align: center; padding: 35px 20px; border-radius: 24px; margin-bottom: 25px; }
        .balance-amount { font-size: 2.5rem; font-weight: 800; margin: 10px 0; }
        .action-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 25px; }
        .action-btn { background: var(--card-bg); padding: 16px; border-radius: 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-decoration: none; color: var(--text-main); border: 1px solid var(--border); }
        .recent-tx-item { display: flex; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid var(--border); }

        /* PAY GRID */
        .pay-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .pay-item { background: var(--card-bg); padding: 20px; border-radius: 16px; text-align: center; border: 1px solid var(--border); cursor: pointer; color: var(--text-main); }
        .pay-icon { font-size: 2rem; margin-bottom: 10px; display: block; }

        /* MODALS */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 100; display: none; justify-content: center; align-items: flex-end; }
        .modal-sheet { background: var(--card-bg); width: 100%; padding: 25px; border-radius: 24px 24px 0 0; animation: slideUp 0.3s ease; max-height: 85vh; overflow-y: auto; color: var(--text-main); }
        @keyframes slideUp { from {transform: translateY(100%);} to {transform: translateY(0);} }

        /* TOGGLE SWITCH */
        .toggle-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid var(--border); }
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(24px); }

    </style>
</head>
<body>

    <header>
        <div class="font-bold text-xl">CryptoPay</div>
        <div onclick="openProfile()" style="width:35px; height:35px; background:#E0E7FF; border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--primary); font-weight:bold; cursor:pointer;">JD</div>
    </header>

    <main id="app-content" class="p-4"></main>

    <div id="profile-modal" class="modal-overlay" onclick="if(event.target === this) closeProfile()">
        <div class="modal-sheet">
            <div class="text-center mb-4">
                <div style="width:80px; height:80px; background:#E0E7FF; border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--primary); font-weight:bold; font-size:2rem; margin:0 auto;">JD</div>
                <h2 class="font-bold text-xl mt-2">John Doe <span style="color:#3B82F6">‚úì</span></h2>
                <div class="text-gray text-sm">@johndoe ‚Ä¢ Tier 1 User</div>
            </div>
            
            <div class="toggle-row">
                <span>Dark Mode</span>
                <label class="switch">
                    <input type="checkbox" id="dark-toggle" onchange="toggleDark()">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="toggle-row" onclick="alert('Support Chat Coming Soon!')">
                <span>Help & Support</span>
                <span>></span>
            </div>
            
            <button class="btn btn-outline" style="border-color:var(--danger); color:var(--danger); margin-top:20px" onclick="resetApp()">Reset App Data</button>
        </div>
    </div>

    <div id="receipt-modal" class="modal-overlay" style="align-items:center;">
        <div class="modal-sheet" style="border-radius:20px; text-align:center;">
            <div style="font-size: 4rem; margin-bottom: 10px">‚úÖ</div>
            <h2 class="font-bold text-xl">Success!</h2>
            <p id="receipt-msg" class="text-gray mt-4">Transaction Completed</p>
            <div class="text-xs text-gray mt-2" id="fee-msg"></div>
            <button class="btn btn-primary mt-4" onclick="closeReceipt()">Done</button>
        </div>
    </div>

    <div id="deposit-modal" class="modal-overlay" onclick="if(event.target === this) document.getElementById('deposit-modal').style.display='none'">
        <div class="modal-sheet">
            <h2 class="font-bold text-xl mb-4">Add Money</h2>
            <div class="input-group"><label>Source</label><select class="select-field"><option>Bank Card</option><option>Bank Transfer</option></select></div>
            <div class="input-group"><label>Amount (NGN)</label><input type="number" id="dep-amt" class="input-field"></div>
            <button class="btn btn-success" onclick="processDeposit()">Fund Wallet</button>
        </div>
    </div>

    <div id="bill-modal" class="modal-overlay" onclick="if(event.target === this) document.getElementById('bill-modal').style.display='none'">
        <div class="modal-sheet">
            <h2 class="font-bold text-xl mb-4">Pay Bill</h2>
            <div class="input-group"><label>Target</label><input type="tel" id="bill-target" class="input-field"></div>
            <div class="input-group"><label>Amount</label><input type="number" id="bill-amt" class="input-field"></div>
            <button class="btn btn-primary" onclick="processBill()">Pay Now</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <a href="#" class="nav-item active" onclick="router('home')"><span class="nav-icon">üè†</span>Home</a>
        <a href="#" class="nav-item" onclick="router('pay')"><span class="nav-icon">üì±</span>Pay</a>
        <a href="#" class="nav-item" onclick="router('send')"><span class="nav-icon">üí∏</span>Send</a>
        <a href="#" class="nav-item" onclick="router('swap')"><span class="nav-icon">üîÑ</span>Swap</a>
        <a href="#" class="nav-item" onclick="router('wallet')"><span class="nav-icon">üíº</span>Wallet</a>
    </nav>

    <script>
        // --- STATE & CONFIG ---
        const defaultState = {
            wallets: { NGN: 25000.00, USDC: 100.00 },
            rates: { USDC_NGN: 1500 },
            history: [{ type: 'Welcome', desc: 'Account Created', amount: '', date: 'Nov 20' }],
            darkMode: false
        };
        let state = JSON.parse(JSON.stringify(defaultState));
        let sendMode = 'wallet';
        let activeBill = '';

        // Load & Init
        try {
            const saved = localStorage.getItem('cryptopayState_v6');
            if(saved) state = JSON.parse(saved);
        } catch(e) {}
        
        // Apply Dark Mode on Load
        if(state.darkMode) {
            document.body.classList.add('dark-mode');
            setTimeout(() => document.getElementById('dark-toggle').checked = true, 100);
        }

        function saveState() { localStorage.setItem('cryptopayState_v6', JSON.stringify(state)); }

        // --- ROUTER ---
        function router(screen) {
            const app = document.getElementById('app-content');
            if(!app) return;
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const activeNav = document.querySelector(`.nav-item[onclick="router('${screen}')"]`);
            if(activeNav) activeNav.classList.add('active');

            if(screen === 'home') renderHome(app);
            else if(screen === 'pay') renderPay(app);
            else if(screen === 'send') renderSend(app);
            else if(screen === 'swap') renderSwap(app);
            else if(screen === 'wallet') renderWallet(app);
        }

        // --- RENDERERS ---
        function renderHome(c) {
            const usdc = state.wallets.USDC;
            const ngn = state.wallets.NGN;
            const rate = state.rates.USDC_NGN;
            const totalUSD = usdc + (ngn/rate);
            
            c.innerHTML = `
                <div class="balance-card">
                    <div class="text-sm" style="opacity:0.9">Total Net Worth</div>
                    <div class="balance-amount">$${totalUSD.toFixed(2)}</div>
                    <div class="text-sm">‚âà ‚Ç¶${((usdc*rate)+ngn).toLocaleString(undefined, {maximumFractionDigits:0})}</div>
                </div>
                <div class="action-grid">
                    <a class="action-btn" onclick="router('send')"><span style="font-size:1.5rem">üì§</span><span class="font-bold text-sm">Send</span></a>
                    <a class="action-btn" onclick="router('pay')"><span style="font-size:1.5rem">üßæ</span><span class="font-bold text-sm">Pay</span></a>
                    <a class="action-btn" onclick="openDeposit()"><span style="font-size:1.5rem">‚ûï</span><span class="font-bold text-sm">Add</span></a>
                </div>
                <h3 class="font-bold mb-2">Recent Activity</h3>
                ${state.history.map(tx => `
                    <div class="recent-tx-item">
                        <div><div class="font-bold">${tx.type}</div><div class="text-xs text-gray">${tx.desc}</div></div>
                        <div class="font-bold ${tx.amount.includes('-')?'text-danger':'text-success'}">${tx.amount}</div>
                    </div>`).join('')}
            `;
        }

        function renderPay(c) {
            c.innerHTML = `
                <h2 class="font-bold text-xl mb-4">Pay Bills</h2>
                <div class="card flex items-center justify-between" style="padding:15px">
                     <div><div class="font-bold">Scan to Pay</div><div class="text-xs text-gray">Merchants & POS</div></div>
                     <div style="font-size:2rem">üì∑</div>
                </div>
                <h3 class="font-bold mt-4">Utilities</h3>
                <div class="pay-grid">
                    <div class="pay-item" onclick="openBill('Airtime')"><span class="pay-icon">üì±</span><div class="font-bold text-sm">Airtime</div></div>
                    <div class="pay-item" onclick="openBill('Data')"><span class="pay-icon">üì∂</span><div class="font-bold text-sm">Data</div></div>
                    <div class="pay-item" onclick="openBill('Electricity')"><span class="pay-icon">üí°</span><div class="font-bold text-sm">Power</div></div>
                    <div class="pay-item" onclick="openBill('TV')"><span class="pay-icon">üì∫</span><div class="font-bold text-sm">TV</div></div>
                </div>`;
        }

        function renderWallet(c) {
            c.innerHTML = `
                <h2 class="font-bold text-xl mb-4">My Assets</h2>
                <div class="card flex justify-between items-center mb-3">
                    <div><div class="font-bold text-xl">üá≥üá¨ NGN</div><div class="text-xs text-gray">Fiat</div></div>
                    <div class="text-right"><div class="font-bold text-xl">‚Ç¶${state.wallets.NGN.toLocaleString()}</div><button class="btn btn-outline" style="padding:5px 10px; margin-top:5px; font-size:0.8rem" onclick="openDeposit()">+ Add Money</button></div>
                </div>
                <div class="card flex justify-between items-center">
                    <div><div class="font-bold text-xl">üá∫üá∏ USDC</div><div class="text-xs text-gray">Stablecoin</div></div>
                    <div class="font-bold text-xl">$${state.wallets.USDC.toFixed(2)}</div>
                </div>`;
        }

        function renderSend(c) {
            const isBank = sendMode === 'bank';
            c.innerHTML = `
                <h2 class="font-bold text-xl mb-4">Send Money</h2>
                <div class="flex mb-4">
                    <button class="btn btn-outline ${!isBank?'active':''}" style="margin-right:10px; flex:1" onclick="sendMode='wallet'; router('send')">To Wallet</button>
                    <button class="btn btn-outline ${isBank?'active':''}" style="flex:1" onclick="sendMode='bank'; router('send')">To Bank</button>
                </div>
                <div class="card">
                    ${isBank ? `
                        <div class="input-group"><label>Bank</label><select class="select-field"><option>GTBank</option><option>OPay</option><option>Access</option></select></div>
                        <div class="input-group"><label>Account</label><input type="number" id="acct" class="input-field" placeholder="1234567890"></div>
                        <div class="input-group"><label>Amount (NGN)</label><input type="number" id="s-amt" class="input-field">
                        <div class="text-xs text-gray mt-2">Fee: 1%</div></div>
                    ` : `
                        <div class="input-group"><label>Username</label><input type="text" id="user" class="input-field" placeholder="@username"></div>
                        <div class="input-group"><label>Amount (USDC)</label><input type="number" id="s-amt" class="input-field">
                        <div class="text-xs text-gray mt-2">Fee: 1%</div></div>
                    `}
                    <button class="btn btn-primary mt-4" onclick="processSend()">${isBank?'Send to Bank':'Send Crypto'}</button>
                </div>`;
        }

        function renderSwap(c) {
            c.innerHTML = `
                <h2 class="font-bold text-xl mb-4">Swap Crypto</h2>
                <div class="card">
                    <div class="input-group"><label>From (NGN)</label><input type="number" id="swapAmt" class="input-field" oninput="calcSwap()"><div class="text-xs text-gray mt-1">Fee: 1%</div></div>
                    <div class="text-center my-2">‚¨áÔ∏è</div>
                    <div class="input-group"><label>To (USDC)</label><input type="text" id="swapOut" class="input-field" disabled></div>
                    <button class="btn btn-primary" onclick="processSwap()">Swap Now</button>
                </div>`;
        }

        // --- LOGIC ---
        function openProfile() { document.getElementById('profile-modal').style.display='flex'; }
        function closeProfile() { document.getElementById('profile-modal').style.display='none'; }
        function toggleDark() {
            state.darkMode = !state.darkMode;
            if(state.darkMode) document.body.classList.add('dark-mode');
            else document.body.classList.remove('dark-mode');
            saveState();
        }
        function resetApp() { if(confirm("Reset everything?")) { localStorage.removeItem('cryptopayState_v6'); location.reload(); } }

        function openDeposit() { document.getElementById('deposit-modal').style.display='flex'; }
        function processDeposit() {
            const amt = parseFloat(document.getElementById('dep-amt').value);
            if(!amt) return alert("Invalid");
            state.wallets.NGN += amt;
            state.history.unshift({ type: 'Deposit', desc: 'Card Funding', amount: `+‚Ç¶${amt.toLocaleString()}`, date: 'Now' });
            saveState();
            document.getElementById('deposit-modal').style.display='none';
            showReceipt(`Funded ‚Ç¶${amt.toLocaleString()}`, "No Fee");
        }

        function openBill(type) { activeBill=type; document.getElementById('bill-modal').style.display='flex'; }
        function processBill() {
            const amt = parseFloat(document.getElementById('bill-amt').value);
            if(!amt || amt > state.wallets.NGN) return alert("Invalid/Low Balance");
            state.wallets.NGN -= amt;
            state.history.unshift({ type: 'Bill Pay', desc: activeBill, amount: `-‚Ç¶${amt.toLocaleString()}`, date: 'Now' });
            saveState();
            document.getElementById('bill-modal').style.display='none';
            showReceipt(`Paid ‚Ç¶${amt}`, "Fee: ‚Ç¶0.00");
        }
        function calcSwap() {
            const val = parseFloat(document.getElementById('swapAmt').value);
            if(val) {
                const fee = val * 0.01;
                const net = val - fee;
                document.getElementById('swapOut').value = (net / state.rates.USDC_NGN).toFixed(2);
            }
            }

        function processSwap() {
            const amt = parseFloat(document.getElementById('swapAmt').value);
            if(!amt || amt > state.wallets.NGN) return alert("Invalid");
            
            const fee = amt * 0.01; // 1% Fee
            const net = amt - fee;
            const recv = net / state.rates.USDC_NGN;
            
            state.wallets.NGN -= amt;
            state.wallets.USDC += recv;
            state.history.unshift({ type: 'Swap', desc: 'NGN to USDC', amount: `+${recv.toFixed(2)} USDC`, date: 'Now' });
            saveState();
            showReceipt(`Swapped ‚Ç¶${amt}`, `Service Fee: ‚Ç¶${fee.toFixed(2)}`);
        }

        function processSend() {
            const amt = parseFloat(document.getElementById('s-amt').value);
            if(!amt) return alert("Enter Amount");
            
            if(sendMode === 'bank') {
                const fee = amt * 0.01;
                const total = amt + fee;
                if(total > state.wallets.NGN) return alert(`Need ‚Ç¶${total} (inc. fee)`);
                state.wallets.NGN -= total;
                state.history.unshift({ type: 'Transfer', desc: 'To Bank', amount: `-‚Ç¶${amt.toLocaleString()}`, date: 'Now' });
                showReceipt(`Sent ‚Ç¶${amt}`, `Service Fee: ‚Ç¶${fee.toFixed(2)}`);
            } else {
                const fee = amt * 0.01;
                const total = amt + fee;
                if(total > state.wallets.USDC) return alert(`Need $${total} (inc. fee)`);
                state.wallets.USDC -= total;
                state.history.unshift({ type: 'Sent', desc: 'To User', amount: `-$${amt}`, date: 'Now' });
                showReceipt(`Sent $${amt}`, `Service Fee: $${fee.toFixed(2)}`);
            }
            saveState();
        }

        function showReceipt(msg, fee) {
            document.getElementById('receipt-msg').textContent = msg;
            document.getElementById('fee-msg').textContent = fee;
            document.getElementById('receipt-modal').style.display = 'flex';
        }
        function closeReceipt() {
            document.getElementById('receipt-modal').style.display = 'none';
            router('home');
        }

        // Init
        setTimeout(() => router('home'), 100);
    </script>
</body>
</html>
